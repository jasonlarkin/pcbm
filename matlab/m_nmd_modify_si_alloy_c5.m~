%function m_ald_taud_si(str_ald,str_nmd_per,str_nmd_vc,str_alloy)
%--------------------------------------------------------------------------
%m_ald_taud(str_ald,str_nmd_perfect,str_nmd_vc,str_alloy)
% m_ald_taud(...
% '/home/jason/disorder/lj/ald/m1.1/10x/Data_fullBZ.xls',...
% '/home/jason/disorder2/lj/alloy/10K/0.05/10x/nmd_vc/work/1/',...
% '/home/jason/disorder2/lj/alloy/10K/0.05/10x/NMD/1/work/',...
% '/home/jason/disorder2/lj/alloy/10K/0.05/10x/nmd_vc/work/1/')
%--------------------------------------------------------------------------

clear

constant = m_constant;

sys_size = '22x';
%--------------------------------------------------------------------------
%load
%-------------------------------------------------------------------------- 
ipt = 1;
str_ald = ['/home/jason/disorder2/si/ald/conv/' sys_size '/Data_fullBZ.xls'];
str_alloy = ['/home/jason/disorder2/si/alloy/0.5/' sys_size '/'];
str_nmd = ['/home/jason/disorder2/si/alloy/0.5/' sys_size '/'];
nmd=load(strcat(str_nmd,'nmd.mat'));
ald = m_joe_read_data_si(str_ald);
alloy = load(strcat(str_alloy,'ALLOY.mat'));
aldsed =...
    m_joe_ald2nmd_si(...
    nmd.NUM_KPTS, nmd.kptmodelist , nmd.NUM_MODES , ald );
cond_aldsed =...
    m_ald_cond(...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),...
    aldsed.vel(:,1)/sqrt(nmd.x0.vm),...
    nmd.x0.VOLUME*constant.ang2m^3)
%initialize
nmdnew.kpt = aldsed.kpt; nmdnew.freq = aldsed.freq/sqrt(nmd.x0.vm);
nmdnew.vel = aldsed.vel/sqrt(nmd.x0.vm); 
%give nmdnew aldsed+taud
nmdnew.life = (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) ));
nmdnew.VOLUME = nmd.x0.VOLUME;

%-------------------------------------------------------------------------- 
%--------------------------------------------------------------------------
%NMD VC CHANGES
%-------------------------------------------------------------------------- 
%--------------------------------------------------------------------------
%1
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    5.0E-12 - reso1 < nmdnew.life & nmdnew.life < 4.0E-11 + reso1 &...
    5.294E12 - reso2 < nmdnew.freq & nmdnew.freq < 6.077E12 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*1.25;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%2
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    5.0E-12 - reso1 < nmdnew.life & nmdnew.life < 4.0E-11 + reso1 &...
    5.8E12 - reso2 < nmdnew.freq & nmdnew.freq < 6.077E12 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*0.5;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%3
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-12 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    7.589E12 - reso2 < nmdnew.freq & nmdnew.freq < 7.589E12 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*0.8;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%4
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-12 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    7.959E12 - reso2 < nmdnew.freq & nmdnew.freq < 7.959E12 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*1.1;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%5
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-12 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    8.676E12 - reso2 < nmdnew.freq & nmdnew.freq < 8.676E12 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*0.7;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%6
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.031E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.051E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*1.25;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%7
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.136E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.136E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*1.2;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%8
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.187E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.201E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*0.9;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%9
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.25E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.289E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*0.65;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%10
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.48E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.48E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*0.7;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%11
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.504E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.504E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*1.1;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%11
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.528E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.528E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*1.3;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%12
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.553E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.557E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*1.28;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%12
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.6E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.63E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*1.3;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%13
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.678E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.767E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*1.4;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%14
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.777E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.868E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*1.5;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 
%15
reso1 = 0.01E-11; reso2 = 0.01E12;
[I,J] = find(...
    1.0E-13 - reso1 < nmdnew.life & nmdnew.life < 10.0E-11 + reso1 &...
    1.89E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.89E13 + reso2 ...
    );
nmdnew.life(I) = nmdnew.life(I)*1.2;

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )
%--------------------------------------------------------------------------
pause
%-------------------------------------------------------------------------- 






%interpolate

%hori
str_hori = ['/home/jason/Documents/sed/hori/ald_taud_' sys_size '_c5.txt'];
A = load(str_hori); B = sortrows(A);
[X,I,J] = unique(B(:,1),'rows');
C(:,1) = B(I,1); C(:,2) = B(I,2); 
hori.freq = C(:,1); hori.life = C(:,2);

loglog(...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,nmdnew.life,'.',...
    hori.freq,hori.life,'.',...
    nmdnew.freq,1E15*nmdnew.freq.^(-2),...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )

%8
reso1 = 0.01E-13; reso2 = 0.01E13;
[I,J] = find(...
    0 - reso1 < nmdnew.life & nmdnew.life < 7.773E-13 + reso1 &...
    1.976E13 - reso2 < nmdnew.freq & nmdnew.freq < 1.30E14 + reso2 ...
    );

%interpolate
yi = interp1(...
    hori.freq,...
    hori.life,...
    nmdnew.freq(I),'cubic');
nmdnew.life(I) = yi*0.9;

%plot interpolate results
loglog(...
    nmdnew.freq,nmdnew.life,'.',...
    aldsed.freq/sqrt(nmd.x0.vm),...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),'.',...
    nmdnew.freq,1E41*nmdnew.freq.^(-4),...
    nmdnew.freq,2*pi./nmdnew.freq...
    )


%conductivity
cond_nmdnew =...
    m_ald_cond(nmdnew.life,nmdnew.vel(:,1),nmd.x0.VOLUME*constant.ang2m^3)
% %plot final
% loglog(...
%     aldsed.freq,...
%     (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
%     (1./alloy.life(:,1)) )),'.',...
%     nmdnew.freq,nmdnew.life,'.'...
%     )


save([str_nmd 'SEDdata.mat'], '-struct', 'nmdnew');


% m_si_alan_save_lifetimes



