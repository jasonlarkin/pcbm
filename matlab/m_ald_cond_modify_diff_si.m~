ipt=1
VIRTUAL_MASS = 1.1;
freq_cutoff = 0;
dph_scaling = 0.5;
vg_scaling = 0.75;
constant = m_constant; lj = m_lj;
constant = m_constant;

sys_size = '20x';
%--------------------------------------------------------------------------
%load
%-------------------------------------------------------------------------- 
ipt = 1;
str_ald = ['/home/jason/disorder2/si/ald/conv/' sys_size '/Data_fullBZ.xls'];
str_alloy = ['/home/jason/disorder2/si/alloy/0.5/' sys_size '/'];
str_nmd = ['/home/jason/disorder2/si/alloy/0.5/' sys_size '/'];
nmd=load(strcat(str_nmd,'nmd.mat'));
ald = m_joe_read_data_si(str_ald);
alloy = load(strcat(str_alloy,'ALLOY.mat'));
aldsed =...
    m_joe_ald2nmd_si(...
    nmd.NUM_KPTS, nmd.kptmodelist , nmd.NUM_MODES , ald );
cond_aldsed =...
    m_ald_cond(...
    (1./( (1./(aldsed.life/sqrt(nmd.x0.vm))) +...
    (1./alloy.life(:,1)) )),...
    aldsed.vel(:,1)/sqrt(nmd.x0.vm),...
    nmd.x0.VOLUME*constant.ang2m^3)


vcald(ipt).cond =...
    m_ald_cond(...
    1./(1./alloy(ipt).alloy.life +...
    1./vcald(ipt).sedald.life)*vcnmd(ipt).nmd.LJ.tau,...
    vcald(ipt).sedald.vel(:,1)*vcnmd(ipt).nmd.LJ.sigma/vcnmd(ipt).nmd.LJ.tau,...
    vcnmd(ipt).nmd.VOLUME);

vcnmd(ipt).cond =...
    m_ald_cond(...
    vcnmd(ipt).sed.life*vcnmd(ipt).nmd.LJ.tau,...
    vcnmd(ipt).sed.groupvel(:,1)*vcnmd(ipt).nmd.LJ.sigma/vcnmd(ipt).nmd.LJ.tau,...
    vcnmd(ipt).nmd.VOLUME);
vcald(ipt).cond
vcnmd(ipt).cond

loglog(...
    vcald(ipt).sedald.freq,...
    1./(1./alloy(ipt).alloy.life + 1./vcald(ipt).sedald.life),'.',...
    vcnmd(ipt).sed.freq,...
    vcnmd(ipt).sed.life,'.'...
    )
%--------------------------------------------------------------------------
pause
%--------------------------------------------------------------------------

%--------------------------------------------------------------------------
%nmd
%--------------------------------------------------------------------------
%adjust for D_ph
vcnmd(ipt).sed.Dphi =...
    vcnmd(ipt).sed.life.*...
    (vcnmd(ipt).sed.groupvel(:,1).^2);
vcnmd(ipt).sed.Dphf = vcnmd(ipt).sed.Dphi;
[Idiff Jdiff] =...
    find(...
    vcnmd(ipt).sed.freq > freq_cutoff & ...
    vcnmd(ipt).sed.Dphi < ...
    (1/3)*af(ipt).sound*vcnmd(ipt).nmd.alat*dph_scaling ...
    );
%swap values
vcnmd(ipt).sed.Dphf(Idiff) = ...
    (1/3)*af(ipt).sound*vcnmd(ipt).nmd.alat*dph_scaling;
old_cond =...
    (constant.kb/vcnmd(ipt).nmd.VOLUME)*...
    sum(...
    vcnmd(ipt).sed.Dphi*...
    vcnmd(ipt).nmd.LJ.sigma^2/vcnmd(ipt).nmd.LJ.tau...
    )
new_cond =...
    (constant.kb/vcnmd(ipt).nmd.VOLUME)*...
    sum(...
    vcnmd(ipt).sed.Dphf*...
    vcnmd(ipt).nmd.LJ.sigma^2/vcnmd(ipt).nmd.LJ.tau...
    )
%--------------------------------------------------------------------------
loglog(...
    vcnmd(ipt).sed.freq,...
    vcnmd(ipt).sed.Dphi,'.',...
    vcnmd(ipt).sed.freq,...
    vcnmd(ipt).sed.Dphf,'.'...
    )
%--------------------------------------------------------------------------

%--------------------------------------------------------------------------
pause
%--------------------------------------------------------------------------

%--------------------------------------------------------------------------
%ald
%--------------------------------------------------------------------------
%adjust for D_ph
vcald(ipt).sedald.Dphi =...
    1./(1./alloy(ipt).alloy.life + 1./vcald(ipt).sedald.life).*...
    (vcald(ipt).sedald.vel(:,1).^2);
vcald(ipt).sedald.Dphf = vcald(ipt).sedald.Dphi;
[Idiff Jdiff] =...
    find(...
    vcald(ipt).sedald.freq > freq_cutoff & ...
    vcald(ipt).sedald.Dphi < ...
    (1/3)*af(ipt).sound*vcnmd(ipt).nmd.alat*dph_scaling ...
    );
%swap values
vcald(ipt).sedald.Dphf(Idiff) = ...
    (1/3)*af(ipt).sound*vcnmd(ipt).nmd.alat*dph_scaling;
old_cond =...
    (constant.kb/vcnmd(ipt).nmd.VOLUME)*...
    sum(...
    vcald(ipt).sedald.Dphi*...
    vcnmd(ipt).nmd.LJ.sigma^2/vcnmd(ipt).nmd.LJ.tau...
    )
new_cond =...
    (constant.kb/vcnmd(ipt).nmd.VOLUME)*...
    sum(...
    vcald(ipt).sedald.Dphf*...
    vcnmd(ipt).nmd.LJ.sigma^2/vcnmd(ipt).nmd.LJ.tau...
    )
%--------------------------------------------------------------------------
loglog(...
    vcald(ipt).sedald.freq,...
    vcald(ipt).sedald.Dphi,'.',...
    vcald(ipt).sedald.freq,...
    vcald(ipt).sedald.Dphf,'.'...
    )
%--------------------------------------------------------------------------

%--------------------------------------------------------------------------
pause
%--------------------------------------------------------------------------

loglog(...
    vcnmd(ipt).sed.freq,...
    vcnmd(ipt).sed.Dphi,'.',...
    vcnmd(ipt).sed.freq,...
    vcnmd(ipt).sed.Dphf,'.',...
    vcald(ipt).sedald.freq,...
    vcald(ipt).sedald.Dphi,'.',...
    vcald(ipt).sedald.freq,...
    vcald(ipt).sedald.Dphf,'.'...
    )


